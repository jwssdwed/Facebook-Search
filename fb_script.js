var userQuery = angular.module('user',['ngAnimate']);userQuery.controller('myUser',function($scope,$http) {  $scope.isInit = true;  $scope.isLoading = false;  $scope.isDetail = false;  $scope.whatQuery = "Chengyu SHENSD";  $scope.whatType = "user";  $scope.myContent="none";  $scope.isFavorited = false;  $scope.isPrevious = false;  $scope.isNext = false;  $scope.setHttpRequest=function($url){    $scope.isLoading=true;        $scope.isFavorited = false;        $scope.isPrevious = false;    //since symbo & has the special meaning in url, we need to change it before passing.    $url = $url.replace(/&/g, "!");    $http({      method : "GET",      //call php script        url : "http://sample-env-1.wtfjrqnkdf.us-west-2.elasticbeanstalk.com/php_script.php?url="+$url+"&isDetail=0",        dataType: 'jsonp',        headers: {'Content-Type': 'application/json; charset=utf-8'}    }).then(function mySucces(response) {      $scope.user = response.data;      $scope.userRes = $scope.user["data"];      if ($scope.userRes) {                for(var i = 0; i < $scope.userRes.length; i++){                    if (localStorage.getItem($scope.userRes[i]["id"])!=null) {                        $scope.userRes[i]["favorited"]=true;                    }                    else                        $scope.userRes[i]["favorited"]=false;                }                //deal with next & previous button        if ($scope.user["paging"]&&$scope.user["paging"].previous)          $scope.isPrevious = true;        else          $scope.isPrevious = false;        if ($scope.user["paging"]&&$scope.user["paging"].next) {          $url = $scope.user["paging"].next;          $url = $url.replace(/&/g, "!");          //an additional php request in order to check whether the next link is available          $http({            method : "GET",              url : "http://sample-env-1.wtfjrqnkdf.us-west-2.elasticbeanstalk.com/php_script.php?url="+$url+"&isDetail=0",              headers: { 'Content-Type': 'application/x-www-form-urlencoded' }          }).then(function mySucces(response) {            $scope.test = response.data["data"];            if ($scope.user["paging"]&&$scope.test.length > 0)              $scope.isNext = true;            else              $scope.isNext = false;          });        }        else{          console.log('fails to find next and previous link ');          $scope.isNext = false;        }      }    }, function myError(response) {        $scope.user = "false";      }).finally(function (){        $scope.isLoading=false;      });   }  $scope.DetailRequest = function($url){    $scope.activePos=0;    $scope.isAlbum=true;    $scope.isPost=true;    $url = $url.replace(/&/g, "!");    if ($scope.hasDetail) {      $http({        method : "GET",        url: "http://sample-env-1.wtfjrqnkdf.us-west-2.elasticbeanstalk.com/php_script.php?url="+$url+"&isDetail=1",          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }      }).then(function mySucces(response){        $scope.detail=response.data;        if (!$scope.detail['albums']) {          $scope.isAlbum=false;        }        if (!$scope.detail['posts']) {          $scope.isPost=false;        }                else{                    for (var i = 0; i < $scope.detail['posts']['data'].length; i++) {                        $scope.detail['posts']['data'][i]["created_time"] = moment($scope.detail['posts']['data'][i]["created_time"]).format('YYYY/MM/DD HH:mm:ss');                    };                }        $scope.isLoadingDetail=false;      }, function myError(response){        console.log("Detail request fails")      });    }    else{      $scope.isLoadingDetail=false;      $scope.isAlbum=false;      $scope.isPost=false;    }  }    $scope.showNext = function($input, $next){    $scope.isLoading=true;      if ($next == 1) {        $url=$input.next;       }      else{        $url=$input.previous;      }      $scope.setHttpRequest($url);    }    $scope.changeType = function($arg){      $scope.whatType=$arg;      if ($scope.myContent!="none"&&$arg!="favorite"&&!$scope.isInit) {            console.log($scope.isDetail)        if ($scope.myContent == "detail") {          $scope.isDetail=true;        }        else{          $scope.isDetail=false;        }        $scope.myContent="table"        $scope.hasDetail = true;   //control event query        $url = "https://graph.facebook.com/v2.8/search?q="+$scope.whatQuery+"&type="+$scope.whatType+"&fields=id,name,picture.width(700).height(700)&access_token=EAAJvrTUjG3oBAPunL5N6OI0irmVe5ek5SeRyXVFdrA9l5wBIOpnxgEnrA2IprU6YshZC4d4EQ9XnpfLCXcHdPC3rk3kZC5qT0p0caZC0FdXsviOPRS0JzYDagSIkP7EOwCCGuZCrs6SHJNYOR1eYHNQkUze1iagZD";        $scope.isLoading=true;        if ($arg=="event") {          $scope.hasDetail=false;        };        if ($arg == "place") {          //get user's current location          var options = {          enableHighAccuracy: true,          timeout: 5000,          maximumAge: 0        };        function success(pos) {          var crd = pos.coords;          $url="https://graph.facebook.com/v2.8/search?center="+crd.latitude+","+crd.longitude+"&q="+$scope.whatQuery+"&type=place&fields=id,name,picture.width(700).height(700)&access_token=EAAJvrTUjG3oBAPunL5N6OI0irmVe5ek5SeRyXVFdrA9l5wBIOpnxgEnrA2IprU6YshZC4d4EQ9XnpfLCXcHdPC3rk3kZC5qT0p0caZC0FdXsviOPRS0JzYDagSIkP7EOwCCGuZCrs6SHJNYOR1eYHNQkUze1iagZD";        };        function error(err) {          console.warn(`ERROR(${err.code}): ${err.message}`);        };        navigator.geolocation.getCurrentPosition(success, error, options);        };        $scope.setHttpRequest($url);      }      else{          if ($arg == "favorite") {              $scope.myContent="favorite"              $scope.userRes = [];              for(var i = 0; i < localStorage.length; i++){                  $scope.userRes[i] = JSON.parse(localStorage.getItem(localStorage.key(i)));              }          }          else{            $scope.myContent="none";          }      }    }    $scope.showDetail = function($id,$profile,$name,$type){      $scope.isLoadingDetail=true;      $scope.isDetail=true;      $scope.myContent="detail";        $scope.userId = $id;        console.log($scope.userId)        if ($type!="event") {            $scope.hasDetail=true;        };        $scope.userProfile = $profile;        $scope.userName = $name;      $scope.detail=""; //init      $scope.fbProfile=$profile;      $scope.fbName=$name;      $url = "https://graph.facebook.com/v2.8/"+$id+"?fields=albums.limit(5){name,photos.limit(2){name,picture}},posts.limit(5){message,created_time}&access_token=EAAJvrTUjG3oBAPunL5N6OI0irmVe5ek5SeRyXVFdrA9l5wBIOpnxgEnrA2IprU6YshZC4d4EQ9XnpfLCXcHdPC3rk3kZC5qT0p0caZC0FdXsviOPRS0JzYDagSIkP7EOwCCGuZCrs6SHJNYOR1eYHNQkUze1iagZD";        if (localStorage.getItem($id)!=null) {            $scope.isFavorited = true;        }        else            $scope.isFavorited = false;      $scope.DetailRequest($url);    }    $scope.back = function() {      // body...        $scope.isDetail=true;        if ($scope.whatType=="favorite"||$scope.whatType=="favorite1") {            $scope.myContent="favorite1";        }        else            $scope.myContent="table";    }    $scope.showPanel = function($item){      $temp = $item["photos"]["data"];      $scope.picture=[];      for (var i = 0; i < $temp.length; i++) {        $url = "https://graph.facebook.com/v2.8/"+$temp[i]["id"]+"/picture?redirect=false&access_token=EAAJvrTUjG3oBAPunL5N6OI0irmVe5ek5SeRyXVFdrA9l5wBIOpnxgEnrA2IprU6YshZC4d4EQ9XnpfLCXcHdPC3rk3kZC5qT0p0caZC0FdXsviOPRS0JzYDagSIkP7EOwCCGuZCrs6SHJNYOR1eYHNQkUze1iagZD";        $url = $url.replace(/&/g, "!");        $http({        method : "GET",        url: "http://sample-env-1.wtfjrqnkdf.us-west-2.elasticbeanstalk.com/php_script.php?url="+$url+"&isDetail=0",        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }      }).then(function mySucces(response){        $scope.picture.push(response.data["data"]);      }, function myError(response){        alert("Request pictures fails")      })      };    }    $scope.search = function (){      if (document.getElementById("keyword").value=="") {      }      else{        $scope.whatQuery=document.getElementById("keyword").value;        $scope.myContent="table";        $scope.isInit = false;        $scope.changeType($scope.whatType)      }    }    $scope.clearAll = function(){      $scope.isLoading = false;    $scope.isDetail = false;    $scope.isInit = true;    if ($scope.myContent!="favorite"||$scope.myContent!="favorite1") {      $scope.myContent="none";    };    $scope.isPrevious = false;    $scope.isNext = false;    document.getElementById("keyword").value="";    }    $scope.post = function($pic,$name){      console.log("here")        FB.ui({                app_id: '685739664939898',                method: 'feed',                link: window.location.href,                picture: $pic,                name: $name,                caption: "FB SEARCH FROM USC CSCI571",            }, function(response){            if (response && !response.error_message){                alert("Posted Successfully");            }            else{                alert("Not Posted");            }        });    }    $scope.favorite = function($content,$id,$uid,$upic,$uname,$utype){        var id = "";        if ($content=="table") {            var id = "icon_"+$id;        }        else{            var id = "iconDetail_"+$id;        }        if (document.getElementById(id).className == "glyphicon glyphicon-star tableIcon") {            document.getElementById(id).className = "glyphicon glyphicon-star-empty tableIcon";            document.getElementById(id).style="color:black";            localStorage.removeItem($uid);        }        else{            var temp = {'pic': $upic, 'name': $uname, 'type': $utype+"s", 'id': $uid};            document.getElementById(id).className = "glyphicon glyphicon-star tableIcon";            document.getElementById(id).style="color:orange";            localStorage.setItem($uid,JSON.stringify(temp));        }    }    $scope.deleteFavorite = function($id){        localStorage.removeItem($id);        //update the favorite table        $scope.userRes = [];        for(var i = 0; i < localStorage.length; i++){            $scope.userRes[i] = JSON.parse(localStorage.getItem(localStorage.key(i)));        }    }});window.fbAsyncInit = function() {         FB.init({        appId      : '685739664939898',        status     : true,        version:  'v2.0',        xfbml      : true    });};// Load the SDK Asynchronously(function(d){  var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}  js = d.createElement('script'); js.id = id; js.async = true;  js.src = "//connect.facebook.net/en_US/sdk.js";  d.getElementsByTagName('head')[0].appendChild(js);}(document));$(document).ready(function(){    $('#searchClick').click(function(){        if(document.getElementById("keyword").value==""){            $('[data-toggle=tooltip]').tooltip('show');        }        else{            $('[data-toggle=tooltip]').tooltip('hide');        }    });    if( navigator.userAgent.match(/Android/i)   || navigator.userAgent.match(/webOS/i)   || navigator.userAgent.match(/iPhone/i)   || navigator.userAgent.match(/iPad/i)   || navigator.userAgent.match(/iPod/i)   || navigator.userAgent.match(/BlackBerry/i)   || navigator.userAgent.match(/Windows Phone/i)   ){    $('#navBar').removeClass('nav-tabs').removeClass('navbar-custom').addClass('nav-stacked').addClass('navbar-custom');    // $('.nav').css("width","100%");    $('#divSearch').removeClass('col-md-8').addClass('col-md-12');    $('div.searchArea').css("width","140%");  }  else{    $('#navBar').removeClass('nav-stacked').removeClass('navbar-custom').addClass('nav-tabs').addClass('navbar-custom');  }});